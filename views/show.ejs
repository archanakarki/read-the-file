<%- include('partials/header'); -%>

<!--Accessible from /namesOfPackages or links from all package lists
    Extracts and displays all content of a package-->


<!--Previous package appears before current package in alphabetically sorted package list-->
<!--Next package appears after the current package in alphabetically sorted package list-->

<%let previousPackage, nextPackage%>
<%for(let i = 0; i < packageNames.length; i++){%>
    <%if(packageNames[i]=== packageUrl){%>
        <%previousPackage = packageNames[i-1]%>
        <%nextPackage = packageNames[i+1]%>
    <%}%>
<%}%>

<!--Navbar-->
<nav id="packageNav">
    <ul>Back to ðŸ‘‰
        <li><a href="/<%=previousPackage%>">Previous package</a></li>
        <li><a href="/">Homepage</a></li>
        <li><a href="/index">All packages</a></li>
        <li><a href="/<%=nextPackage%>">Next package</a></li>
    </ul>
</nav>

<!--Displays all details of a package-->
<!--Highlighted - Package name, Dependencies with 'Depends' key and Descriptions-->
<!--Package name in Depends can be clicked and all details about matching package is displayed-->
<div id="tableDiv">
        <table>
            <!--Title-->
            <tr>
                <th> <h1 id="showh1"><%=packageUrl%></h1></th>
            </tr>
            <!--Content-->
            <%for(let i = 0; i < keys.length; i++){%>
                <tr>
                <!--Condition 1 : Key matches Package, Description, Depends keep it for highlighting and additional modification-->
                <%if((keys[i].match(/Package/g)) || (keys[i].match(/Description/g)) || (keys[i].match(/Depends/g))){%>
                    <td class="keys" id="keys"><%=keys[i]%></td>
                        <!--Condition 1.1 Finding if the values of Depends matched any text from package-->
                        <% if(keys[i].match(/Depends/g)){ %>
                        <!--Turning the matching package name's value as href link-->
                         <td class="values" id="values">
                            <!--Example Depends = python (>= 2.6), python (<< 2.8)-->
                            <!--Splitted based on space and omitted arr el containing symbols, empty char, parenthesis-->
                            <!--Remaining are treated as package names for links-->
                            <%let package = values[i].split(/[\s]/g)%>
                            <%package.forEach((each)=>{%>
                            <% if(!each.match(/[()=,|><]/) && each !== ''){ %>
                                <a href="/<%=each%>"><%=each%> <br> </a> <!--each = extracted strings as package name-->
                            <%}%>
                            <%})%>
                         </td>
                         <%}else if(keys[i].match(/Description/g)){ %>
                            <!--Condition 1.2 if Key is Description = Capitalise its initial leter-->
                            <%let capitalise = values[i].charAt(0).toUpperCase() + values[i].substring(1)%>
                            <td class="values" id="values"><%=capitalise%></td>
                         <%} else{%>
                            <!--Condition 1.3 Remaining key(Package) can be displayed highlighted as it is-->
                            <td class="values" id="values"><%=values[i]%></td>
                         <%}%>
                <%} else{%>
                <!--Condition 2 : All other Key that doesnot match Package, Description, Depends can be displayed normally-->
                        <td id="keys"><%=keys[i]%></td>
                        <td id="values"><%=values[i]%></td>
                <%}%>
                </tr>
            <%}%>  
        </table>
</div>


<%- include('partials/footer'); -%>
